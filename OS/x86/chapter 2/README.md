# Chapter 2 处理器、内存和指令

## 8086

### 8086的通用寄存器

8086处理器内部有8个16位的通用寄存器，分别被命名为`AX`, `BX`, `CX`, `DX`, `SI`, `DI`, `BP`, `SP`。

这8个寄存器中的前4个又各自可以拆分为两个8位的寄存器来使用。

### 内存分段机制

采用分段策略之后，一个内存单元的地址可以采用逻辑地址`segment:offset`来表示。

为了在硬件一级提供对`segment:offset`内存访问模式的支持，处理器至少需要提供两个段寄存器：

+ 代码段寄存器(Code Segment, CS)
+ 数据段寄存器(Data Segment, DS)

### 8086的内存分段机制

如下图所示展示了8086处理器内部组成结构示意图。

[8086处理器内部组成结构示意图](https://s2.loli.net/2022/03/13/BkcFdG4jliUsPn1.png)

在进行数据传送或者算术逻辑运算的时候，使用算术逻辑部件。比如，将`AX`的内容和`CX`的内容相加，结果仍在`AX`中，那么，在相加的结果返回到`AX`之前，需要通过一个叫数据暂存器的寄存器中转。

8086内部有四个段寄存器。其中，CS和DS已经介绍。ES是附加段寄存器。附件段的意思是当需要在程序中同时使用两个数据段时，DS指向一个，ES指向另一个。可以在指令中指定使用DS和ES中的哪一个。SS是栈段寄存器。

IP是指令指针寄存器，它只和CS一起使用，而且只有处理器才能直接改变它的内容。当一段代码开始执行时，CS指向代码段的起始地址，IP则指向段内偏移。这样由CS和IP共同形成逻辑地址，并由总线接口部件变换成物理地址来获取指令。然后，处理器会自动根据当前指令的长度来改变IP的值，使它指向下一条指令。

由于16位地址提供的实际内存过小，8086提供了20位的物理地址。8086处理器在形成物理地址时，先将段寄存器的内容左移4位，形成20位的段地址，然后再同16位的偏移地址相加，得到20位的物理地址。
